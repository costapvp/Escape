<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>لعبة الهروب من الشرطي</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            direction: rtl;
            position: fixed;
            width: 100%;
            height: 100%;
            touch-action: none;
        }

        #gameContainer {
            width: 100vw;
            height: 100vh;
            position: relative;
            background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 100%);
        }

        #gameCanvas {
            display: block;
            background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 100%);
            touch-action: none;
        }

        #gameUI {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 100;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 10px;
        }

        #levelUp {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 215, 0, 0.9);
            color: #000;
            font-size: 24px;
            font-weight: bold;
            padding: 20px;
            border-radius: 15px;
            display: none;
            z-index: 150;
            animation: bounce 0.5s ease-in-out;
        }

        @keyframes bounce {
            0%, 20%, 60%, 100% { transform: translate(-50%, -50%) translateY(0); }
            40% { transform: translate(-50%, -50%) translateY(-10px); }
            80% { transform: translate(-50%, -50%) translateY(-5px); }
        }

        #startScreen, #gameOverScreen, #clothesScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 200;
            overflow-y: auto;
            padding: 20px;
        }

        #gameOverScreen, #clothesScreen {
            display: none;
        }

        button {
            padding: 12px 25px;
            font-size: 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px;
            transition: all 0.3s;
            min-height: 44px;
            min-width: 100px;
        }

        button:hover, button:active {
            background: #45a049;
            transform: scale(0.95);
        }

        .character-btn {
            background: #2196F3;
            margin: 5px;
            padding: 12px 20px;
            font-size: 14px;
        }

        .character-btn:hover, .character-btn:active {
            background: #1976D2;
        }

        .character-btn.selected {
            background: #FF9800;
        }

        .clothes-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin: 20px 0;
            max-width: 400px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            background: rgba(0,0,0,0.2);
        }

        .clothes-btn {
            background: #9C27B0;
            font-size: 18px;
            padding: 10px;
            border-radius: 8px;
            min-height: 50px;
            min-width: 50px;
            position: relative;
            transition: all 0.3s ease;
        }

        .clothes-btn:hover, .clothes-btn:active {
            background: #7B1FA2;
            transform: scale(1.05);
        }

        .clothes-btn.selected {
            background: #FF5722;
            box-shadow: 0 0 15px rgba(255, 87, 34, 0.5);
            transform: scale(1.1);
        }

        .clothes-btn.locked {
            background: #424242;
            opacity: 0.5;
            cursor: not-allowed;
        }

        .clothes-btn.locked:hover {
            background: #424242;
            transform: none;
        }

        .level-indicator {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #FF9800;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }

        #instructions {
            text-align: center;
            margin: 15px;
            font-size: 14px;
            line-height: 1.4;
        }

        .mobile-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            z-index: 100;
        }

        .control-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.5);
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
        }

        .control-btn:active {
            background: rgba(255, 255, 255, 0.5);
            transform: scale(0.9);
        }

        .character-animation {
            animation: characterMove 0.5s ease-in-out;
        }

        @keyframes characterMove {
            0% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-5px) rotate(-5deg); }
            50% { transform: translateY(-10px) rotate(0deg); }
            75% { transform: translateY(-5px) rotate(5deg); }
            100% { transform: translateY(0px) rotate(0deg); }
        }

        .special-effect {
            animation: sparkle 1s ease-in-out infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        @media (max-width: 480px) {
            #gameUI {
                font-size: 14px;
                top: 5px;
                right: 5px;
                padding: 8px;
            }
            
            button {
                font-size: 14px;
                padding: 10px 20px;
            }
            
            .control-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        
        <div id="gameUI">
            <div>النقاط: <span id="score">0</span></div>
            <div>الأموال: <span id="coins">0</span></div>
            <div>المستوى: <span id="level">1</span></div>
        </div>

        <div id="levelUp">
            🎉 مستوى جديد! 🎉
            <div style="font-size: 18px; margin-top: 10px;">تم فتح ملابس جديدة!</div>
        </div>

        <div class="mobile-controls">
            <div class="control-btn" id="leftBtn">←</div>
            <div class="control-btn" id="jumpBtn">↑</div>
            <div class="control-btn" id="rightBtn">→</div>
        </div>

        <div id="startScreen">
            <h1 style="font-size: 36px; margin-bottom: 20px; color: #FFD700;">🏃‍♂️ لعبة الهروب من الشرطي</h1>
            
            <div id="instructions">
                <p>🎮 لعبة سهلة ومتدرجة الصعوبة!</p>
                <p>⬆️ اقفز فوق السيارات والقطارات</p>
                <p>⬅️➡️ تحرك بين المسارات الثلاثة</p>
                <p>💰 اجمع الأموال الكثيرة!</p>
                <p>👮‍♂️ اهرب من الشرطي!</p>
                <p>📈 المستويات 1-3: سهل جداً (سيارات صغيرة)</p>
                <p>📈 المستويات 4-6: سهل (سيارات متنوعة)</p>
                <p>📈 المستويات 7+: تحدي تدريجي!</p>
                <p>👕 120 زي مختلف في 20 مستوى!</p>
            </div>

            <div style="margin: 15px;">
                <h3>اختر شخصيتك:</h3>
                <div style="display: flex; flex-wrap: wrap; justify-content: center;">
                    <button class="character-btn selected" data-character="boy">🧑‍🦱 الولد</button>
                    <button class="character-btn" data-character="girl">👩‍🦰 الأخت</button>
                    <button class="character-btn" data-character="father">👨‍🦲 الأب</button>
                    <button class="character-btn" data-character="mother">👩‍🦳 الأم</button>
                </div>
            </div>

            <button onclick="showClothesScreen()">تغيير الملابس 👕</button>
            <button onclick="startGame()">ابدأ اللعب</button>
        </div>

        <div id="clothesScreen">
            <h2 style="font-size: 28px; margin-bottom: 20px;">👕 اختر ملابسك</h2>
            <div>المستوى الحالي: <span id="clothesLevel">1</span></div>
            <div style="margin-bottom: 20px;">الملابس المتاحة حسب مستواك</div>
            
            <div class="clothes-grid" id="clothesGrid">
                <!-- سيتم ملؤها بـ JavaScript -->
            </div>
            
            <div style="margin: 15px; font-size: 14px; text-align: center;">
                <p>🎯 كل 100 نقطة = مستوى جديد</p>
                <p>📈 20 مستوى مع 120 زي مختلف!</p>
                <p>🔓 المستوى 1-5: ملابس عادية</p>
                <p>⚡ المستوى 6-10: شخصيات خارقة</p>
                <p>🌟 المستوى 11-15: أزياء مميزة</p>
                <p>🏆 المستوى 16-20: أزياء أسطورية</p>
            </div>
            
            <button onclick="backToStart()">العودة للقائمة الرئيسية</button>
        </div>

        <div id="gameOverScreen">
            <h2 style="font-size: 28px; margin-bottom: 15px;">انتهت اللعبة! 😵</h2>
            <div style="font-size: 20px; margin-bottom: 15px;">
                <div>النقاط النهائية: <span id="finalScore">0</span></div>
                <div>الأموال المجمعة: <span id="finalCoins">0</span></div>
                <div>المستوى المحقق: <span id="finalLevel">1</span></div>
            </div>
            <button onclick="restartGame()">العب مرة أخرى</button>
            <button onclick="showStartScreen()">الشاشة الرئيسية</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // إعداد حجم الكانفاس للهاتف
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();

        // متغيرات اللعبة
        let gameRunning = false;
        let score = 0;
        let coins = 0;
        let level = 1;
        let gameSpeed = 3;
        let selectedCharacter = 'boy';
        let selectedClothes = '👕';
        let animationFrame = 0;
        let isMoving = false;
        let specialEffect = false;

        // شخصيات اللعبة - الجسد كامل مع اليدين والقدمين
        const characters = {
            boy: {
                body: '👤',
                running: ['🏃‍♂️', '🏃‍♂️'],
                jumping: '🤸‍♂️',
                landing: '🤾‍♂️'
            },
            girl: {
                body: '👤',
                running: ['🏃‍♀️', '🏃‍♀️'],
                jumping: '🤸‍♀️',
                landing: '🤾‍♀️'
            },
            father: {
                body: '👤',
                running: ['🏃‍♂️', '🏃‍♂️'],
                jumping: '🤸‍♂️',
                landing: '🤾‍♂️'
            },
            mother: {
                body: '👤',
                running: ['🏃‍♀️', '🏃‍♀️'],
                jumping: '🤸‍♀️',
                landing: '🤾‍♀️'
            }
        };

        // ملابس متاحة حسب المستوى - ملابس حقيقية للجسم
        const clothesByLevel = {
            1: ['👕', '👔', '🦺', '👶', '🧒'],
            2: ['👗', '👘', '🥼', '👯‍♀️', '💃', '🕺'],
            3: ['🧥', '👚', '🥻', '🧦', '👢', '👠'],
            4: ['🦸‍♂️', '🦸‍♀️', '🧙‍♂️', '🧙‍♀️', '🦹‍♂️', '🦹‍♀️'],
            5: ['👮‍♂️', '👮‍♀️', '👨‍⚕️', '👩‍⚕️', '👨‍🍳', '👩‍🍳'],
            6: ['👨‍💼', '👩‍💼', '👨‍🔧', '👩‍🔧', '👨‍🚀', '👩‍🚀'],
            7: ['🧛‍♂️', '🧛‍♀️', '🧟‍♂️', '🧟‍♀️', '👺', '👹'],
            8: ['🧚‍♂️', '🧚‍♀️', '🧜‍♂️', '🧜‍♀️', '🧝‍♂️', '🧝‍♀️'],
            9: ['👸', '🤴', '👰‍♀️', '👰‍♂️', '🤵‍♂️', '🤵‍♀️'],
            10: ['🎅', '🤶', '🧑‍🎄', '🎪', '🤹‍♂️', '🤹‍♀️'],
            11: ['👨‍🎨', '👩‍🎨', '👨‍🎤', '👩‍🎤', '👨‍🎓', '👩‍🎓'],
            12: ['👨‍💻', '👩‍💻', '👨‍🔬', '👩‍🔬', '👨‍🏫', '👩‍🏫'],
            13: ['👨‍🌾', '👩‍🌾', '👨‍🍳', '👩‍🍳', '👨‍⚖️', '👩‍⚖️'],
            14: ['👨‍✈️', '👩‍✈️', '👨‍🚒', '👩‍🚒', '👨‍⚕️', '👩‍⚕️'],
            15: ['👨‍🎭', '👩‍🎭', '🤖', '👽', '👻', '💀'],
            16: ['🦄', '🐉', '🦋', '🌟', '⭐', '✨'],
            17: ['🌸', '🌺', '🌻', '🌹', '🌷', '🌼'],
            18: ['🦁', '🐯', '🐻', '🐼', '🐨', '🐵'],
            19: ['⚽', '🏀', '🏈', '⚾', '🎾', '🏐'],
            20: ['🎊', '🎉', '🎈', '🎀', '🎁', '💝']
        };

        // اللاعب
        const player = {
            x: canvas.width / 2,
            y: canvas.height - 150,
            width: 60,
            height: 80,
            velocityY: 0,
            jumping: false,
            landing: false,
            lane: 1,
            character: characters.boy,
            currentClothes: '👕',
            animating: false,
            jumpHeight: 0,
            runningFrame: 0,
            landingTimer: 0
        };

        // الشرطي
        const police = {
            x: canvas.width / 2,
            y: canvas.height - 200,
            width: 60,
            height: 80,
            character: '👮‍♂️',
            runningFrame: 0
        };

        // العقبات والأموال
        let obstacles = [];
        let moneyCoins = [];
        let particles = [];

        // التحكم باللمس المحسن للهاتف
        let touchStartX = 0;
        let touchStartY = 0;
        let isSwipeGesture = false;
        const swipeThreshold = 30;
        const tapTimeout = 200;

        // إعداد أزرار التحكم للهاتف
        document.getElementById('leftBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            moveLeft();
        });

        document.getElementById('rightBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            moveRight();
        });

        document.getElementById('jumpBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            jump();
        });

        // منع السلوك الافتراضي للمس
        document.addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });

        // التحكم بالحركة السريعة
        function moveLeft() {
            if (player.lane > 0) {
                player.lane--;
                updatePlayerPosition();
                player.animating = true;
                setTimeout(() => { player.animating = false; }, 300);
            }
        }

        function moveRight() {
            if (player.lane < 2) {
                player.lane++;
                updatePlayerPosition();
                player.animating = true;
                setTimeout(() => { player.animating = false; }, 300);
            }
        }

        function jump() {
            if (!player.jumping && !player.landing) {
                player.velocityY = -16; // قفزة أقل ارتفاعاً للسهولة
                player.jumping = true;
                player.landing = false;
                player.animating = true;
                player.jumpHeight = 0;
                setTimeout(() => { player.animating = false; }, 600);
            }
        }

        function updatePlayerPosition() {
            const laneWidth = canvas.width / 3;
            player.x = laneWidth * player.lane + (laneWidth / 2) - (player.width / 2);
        }

        // التحكم بالسحب السريع
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
            isSwipeGesture = false;
        }, { passive: false });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (!gameRunning) return;
            
            const touchX = e.touches[0].clientX;
            const touchY = e.touches[0].clientY;
            const deltaX = touchX - touchStartX;
            const deltaY = touchY - touchStartY;

            if (Math.abs(deltaX) > swipeThreshold || Math.abs(deltaY) > swipeThreshold) {
                isSwipeGesture = true;
                
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    // حركة أفقية سريعة
                    if (deltaX > swipeThreshold) {
                        moveRight();
                        touchStartX = touchX; // إعادة تعيين للحركة المستمرة
                    } else if (deltaX < -swipeThreshold) {
                        moveLeft();
                        touchStartX = touchX;
                    }
                } else if (deltaY < -swipeThreshold) {
                    // حركة عمودية للقفز
                    jump();
                    touchStartY = touchY;
                }
            }
        }, { passive: false });

        canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
            if (!isSwipeGesture && gameRunning) {
                // نقرة سريعة للقفز
                jump();
            }
        }, { passive: false });

        // اختيار الشخصية
        document.querySelectorAll('.character-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.character-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                selectedCharacter = btn.dataset.character;
                updateClothesLevel();
            });
        });

        function showClothesScreen() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('clothesScreen').style.display = 'flex';
            updateClothesGrid();
        }

        function backToStart() {
            document.getElementById('clothesScreen').style.display = 'none';
            document.getElementById('startScreen').style.display = 'flex';
        }

        function updateClothesLevel() {
            document.getElementById('clothesLevel').textContent = level;
        }

        function updateClothesGrid() {
            const grid = document.getElementById('clothesGrid');
            grid.innerHTML = '';
            
            // إضافة عداد للملابس المتاحة
            let availableCount = 0;
            let totalCount = 0;
            
            for (let lvl = 1; lvl <= 20; lvl++) {
                if (clothesByLevel[lvl]) {
                    clothesByLevel[lvl].forEach(clothes => {
                        totalCount++;
                        const btn = document.createElement('button');
                        btn.className = 'clothes-btn';
                        btn.innerHTML = clothes;
                        
                        // إضافة مؤشر المستوى
                        const levelIndicator = document.createElement('div');
                        levelIndicator.className = 'level-indicator';
                        levelIndicator.textContent = lvl;
                        btn.appendChild(levelIndicator);
                        
                        if (lvl <= level) {
                            // متاح
                            availableCount++;
                            if (clothes === selectedClothes) {
                                btn.classList.add('selected');
                            }
                            btn.addEventListener('click', () => {
                                document.querySelectorAll('.clothes-btn').forEach(b => b.classList.remove('selected'));
                                btn.classList.add('selected');
                                selectedClothes = clothes;
                            });
                        } else {
                            // مقفل
                            btn.classList.add('locked');
                            btn.title = `يفتح في المستوى ${lvl}`;
                        }
                        
                        grid.appendChild(btn);
                    });
                }
            }
            
            // تحديث عداد الملابس
            const counterDiv = document.createElement('div');
            counterDiv.style.cssText = 'grid-column: 1/-1; text-align: center; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 5px; margin-top: 10px;';
            counterDiv.innerHTML = `
                <div style="font-size: 16px; font-weight: bold;">📊 الملابس المتاحة</div>
                <div style="font-size: 14px; margin-top: 5px;">${availableCount} من ${totalCount} زي متاح</div>
                <div style="font-size: 12px; color: #FFD700; margin-top: 3px;">🔓 ${Math.max(0, (level * 6) - availableCount)} زي جديد في المستوى القادم</div>
            `;
            grid.appendChild(counterDiv);
        }

        function startGame() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('clothesScreen').style.display = 'none';
            gameRunning = true;
            score = 0;
            coins = 0;
            gameSpeed = 3;
            animationFrame = 0;
            
            // إعداد اللاعب
            player.character = characters[selectedCharacter];
            player.currentClothes = selectedClothes;
            updatePlayerPosition();
            player.y = canvas.height - 150;
            player.velocityY = 0;
            player.jumping = false;
            player.landing = false;
            player.lane = 1;
            player.runningFrame = 0;
            player.landingTimer = 0;

            // إعادة تعيين المصفوفات
            obstacles = [];
            moneyCoins = [];
            particles = [];

            gameLoop();
        }

        function restartGame() {
            document.getElementById('gameOverScreen').style.display = 'none';
            startGame();
        }

        function showStartScreen() {
            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('startScreen').style.display = 'flex';
            gameRunning = false;
        }

        function gameOver() {
            gameRunning = false;
            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalCoins').textContent = coins;
            document.getElementById('finalLevel').textContent = level;
            document.getElementById('gameOverScreen').style.display = 'flex';
        }

        function checkLevelUp() {
            const newLevel = Math.floor(score / 100) + 1;
            if (newLevel > level) {
                level = newLevel;
                showLevelUp();
                specialEffect = true;
                setTimeout(() => { specialEffect = false; }, 3000);
            }
        }

        function showLevelUp() {
            const levelUpDiv = document.getElementById('levelUp');
            levelUpDiv.style.display = 'block';
            setTimeout(() => {
                levelUpDiv.style.display = 'none';
            }, 2000);
        }

        function updatePlayer() {
            // فيزياء القفز المحسنة والسهلة
            if (player.jumping) {
                player.y += player.velocityY;
                player.velocityY += 0.8; // جاذبية أقل للسهولة
                player.jumpHeight = Math.abs(player.velocityY);

                if (player.y >= canvas.height - 150) {
                    player.y = canvas.height - 150;
                    player.jumping = false;
                    player.landing = true;
                    player.landingTimer = 20; // مدة حركة الهبوط
                    player.velocityY = 0;
                    player.jumpHeight = 0;
                }
            }

            // حركة الهبوط
            if (player.landing) {
                player.landingTimer--;
                if (player.landingTimer <= 0) {
                    player.landing = false;
                }
            }

            // تحديث إطار الحركة للجري
            if (!player.jumping && !player.landing) {
                player.runningFrame = (player.runningFrame + 0.2) % 2;
            }
        }

        function createObstacle() {
            // تدرج الصعوبة حسب المستوى
            let spawnRate = 0.015; // معدل أساسي منخفض
            
            if (level <= 3) {
                spawnRate = 0.012; // سهل جداً
            } else if (level <= 6) {
                spawnRate = 0.018; // سهل
            } else if (level <= 10) {
                spawnRate = 0.025; // متوسط
            } else if (level <= 15) {
                spawnRate = 0.032; // صعب
            } else {
                spawnRate = 0.040; // صعب جداً
            }
            
            if (Math.random() < spawnRate) {
                const lane = Math.floor(Math.random() * 3);
                const laneWidth = canvas.width / 3;
                
                // نوع العقبة حسب المستوى
                let obstacle;
                
                if (level <= 3) {
                    // المستويات الأولى: سيارات صغيرة فقط
                    const easyCars = ['🚗', '🚕', '🚙'];
                    obstacle = {
                        x: laneWidth * lane + (laneWidth / 2) - 25,
                        y: -60,
                        width: 50,
                        height: 50,
                        type: easyCars[Math.floor(Math.random() * easyCars.length)],
                        category: 'vehicle',
                        canJumpOver: true
                    };
                } else if (level <= 6) {
                    // مستويات متوسطة: سيارات متنوعة
                    const mediumCars = ['🚗', '🚕', '🚙', '🚌', '🚎', '🏎️'];
                    obstacle = {
                        x: laneWidth * lane + (laneWidth / 2) - 30,
                        y: -65,
                        width: 60,
                        height: 55,
                        type: mediumCars[Math.floor(Math.random() * mediumCars.length)],
                        category: 'vehicle',
                        canJumpOver: true
                    };
                } else if (level <= 10) {
                    // مستويات متقدمة: قطارات وسيارات
                    const obstacleType = Math.random();
                    if (obstacleType < 0.6) {
                        const allCars = ['🚗', '🚕', '🚙', '🚌', '🚎', '🏎️', '🚓', '🚑', '🚒'];
                        obstacle = {
                            x: laneWidth * lane + (laneWidth / 2) - 30,
                            y: -70,
                            width: 60,
                            height: 60,
                            type: allCars[Math.floor(Math.random() * allCars.length)],
                            category: 'vehicle',
                            canJumpOver: true
                        };
                    } else {
                        const smallTrains = ['🚊', '🚋', '🚇'];
                        obstacle = {
                            x: laneWidth * lane + (laneWidth / 2) - 35,
                            y: -75,
                            width: 70,
                            height: 65,
                            type: smallTrains[Math.floor(Math.random() * smallTrains.length)],
                            category: 'train',
                            canJumpOver: true
                        };
                    }
                } else {
                    // مستويات صعبة: جميع الأنواع + حفر
                    const obstacleType = Math.random();
                    if (obstacleType < 0.4) {
                        const allCars = ['🚗', '🚕', '🚙', '🚌', '🚎', '🏎️', '🚓', '🚑', '🚒', '🚐', '🛻'];
                        obstacle = {
                            x: laneWidth * lane + (laneWidth / 2) - 30,
                            y: -70,
                            width: 60,
                            height: 60,
                            type: allCars[Math.floor(Math.random() * allCars.length)],
                            category: 'vehicle',
                            canJumpOver: true
                        };
                    } else if (obstacleType < 0.8) {
                        const allTrains = ['🚂', '🚆', '🚊', '🚋', '🚄', '🚅', '🚇', '🚈'];
                        obstacle = {
                            x: laneWidth * lane + (laneWidth / 2) - 35,
                            y: -80,
                            width: 70,
                            height: 70,
                            type: allTrains[Math.floor(Math.random() * allTrains.length)],
                            category: 'train',
                            canJumpOver: true
                        };
                    } else {
                        const roadHazards = ['🕳️', '⚡', '💥'];
                        obstacle = {
                            x: laneWidth * lane + (laneWidth / 2) - 25,
                            y: -50,
                            width: 50,
                            height: 30,
                            type: roadHazards[Math.floor(Math.random() * roadHazards.length)],
                            category: 'road',
                            canJumpOver: true,
                            onGround: true
                        };
                    }
                }
                
                obstacles.push(obstacle);
            }
        }', '🚜'];
                const selectedType = obstacleTypes[Math.floor(Math.random() * obstacleTypes.length)];
                
                obstacles.push({
                    x: laneWidth * lane + (laneWidth / 2) - 30,
                    y: -70,
                    width: 60,
                    height: 60,
                    type: selectedType,
                    canJumpOver: true
                });
            }
        }

        function createMoney() {
            // زيادة معدل ظهور الأموال للمساعدة
            let coinRate = 0.025; // معدل أساسي عالي
            
            if (level <= 3) {
                coinRate = 0.035; // كثير من الأموال في البداية
            } else if (level <= 6) {
                coinRate = 0.030;
            } else if (level <= 10) {
                coinRate = 0.025;
            } else {
                coinRate = 0.020;
            }
            
            if (Math.random() < coinRate) {
                const lane = Math.floor(Math.random() * 3);
                const laneWidth = canvas.width / 3;
                moneyCoins.push({
                    x: laneWidth * lane + (laneWidth / 2) - 20,
                    y: -40,
                    width: 40,
                    height: 40
                });
            }
        }

        function createParticle(x, y) {
            for (let i = 0; i < 5; i++) {
                particles.push({
                    x: x,
                    y: y,
                    velocityX: (Math.random() - 0.5) * 4,
                    velocityY: -Math.random() * 3,
                    life: 30,
                    maxLife: 30
                });
            }
        }

        function updateObstacles() {
            // تحديث العقبات
            for (let i = obstacles.length - 1; i >= 0; i--) {
                obstacles[i].y += gameSpeed;
                
                if (obstacles[i].y > canvas.height) {
                    obstacles.splice(i, 1);
                    score += 15;
                    checkLevelUp();
                }
            }

            // تحديث الأموال
            for (let i = moneyCoins.length - 1; i >= 0; i--) {
                moneyCoins[i].y += gameSpeed;
                
                if (moneyCoins[i].y > canvas.height) {
                    moneyCoins.splice(i, 1);
                }
            }

            // تحديث الجسيمات
            for (let i = particles.length - 1; i >= 0; i--) {
                const particle = particles[i];
                particle.x += particle.velocityX;
                particle.y += particle.velocityY;
                particle.velocityY += 0.1;
                particle.life--;
                
                if (particle.life <= 0) {
                    particles.splice(i, 1);
                }
            }
        }

        function checkCollisions() {
            // التصادم مع العقبات - نظام أكثر تسامحاً
            obstacles.forEach((obstacle, index) => {
                // تقليل منطقة التصادم للسهولة
                const playerHitBox = {
                    x: player.x + 10,
                    y: player.y + 10,
                    width: player.width - 20,
                    height: player.height - 20
                };
                
                const obstacleHitBox = {
                    x: obstacle.x + 5,
                    y: obstacle.y + 5,
                    width: obstacle.width - 10,
                    height: obstacle.height - 10
                };
                
                if (playerHitBox.x < obstacleHitBox.x + obstacleHitBox.width &&
                    playerHitBox.x + playerHitBox.width > obstacleHitBox.x &&
                    playerHitBox.y < obstacleHitBox.y + obstacleHitBox.height &&
                    playerHitBox.y + playerHitBox.height > obstacleHitBox.y) {
                    
                    // إذا كان اللاعب يقفز، يمكنه تجاوز العقبة بسهولة أكبر
                    if (player.jumping && playerHitBox.y + playerHitBox.height < obstacleHitBox.y + 30) {
                        // نجح في القفز فوق العقبة
                        score += 20; // نقاط إضافية
                        obstacles.splice(index, 1); // إزالة العقبة
                        createParticle(obstacle.x, obstacle.y);
                    } else if (!player.jumping && obstacle.onGround) {
                        // تصادم مع حفرة في الأرض
                        gameOver();
                    } else if (!player.jumping) {
                        // تصادم عادي
                        gameOver();
                    }
                }
            });

            // جمع الأموال - منطقة أكبر للسهولة
            for (let i = moneyCoins.length - 1; i >= 0; i--) {
                const coin = moneyCoins[i];
                const coinHitBox = {
                    x: coin.x - 10,
                    y: coin.y - 10,
                    width: coin.width + 20,
                    height: coin.height + 20
                };
                
                if (player.x < coinHitBox.x + coinHitBox.width &&
                    player.x + player.width > coinHitBox.x &&
                    player.y < coinHitBox.y + coinHitBox.height &&
                    player.y + player.height > coinHitBox.y) {
                    moneyCoins.splice(i, 1);
                    coins += 15;
                    score += 10;
                    createParticle(coin.x, coin.y);
                    checkLevelUp();
                }
            }
        }

        function draw() {
            // مسح الشاشة
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#98FB98');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // رسم الخطوط
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 4;
            ctx.setLineDash([30, 15]);
            
            const laneWidth = canvas.width / 3;
            for (let i = 1; i < 3; i++) {
                ctx.beginPath();
                ctx.moveTo(laneWidth * i, 0);
                ctx.lineTo(laneWidth * i, canvas.height);
                ctx.stroke();
            }

            // رسم اللاعب مع الحركات والملابس
            ctx.font = '60px Arial';
            ctx.textAlign = 'center';
            
            if (specialEffect) {
                ctx.shadowColor = '#FFD700';
                ctx.shadowBlur = 20;
            }
            
            // اختيار الحركة المناسبة
            let currentSprite;
            if (player.jumping) {
                currentSprite = player.character.jumping;
            } else if (player.landing) {
                currentSprite = player.character.landing;
            } else {
                // حركة الجري
                const runIndex = Math.floor(player.runningFrame);
                currentSprite = player.character.running[runIndex];
            }
            
            // رسم الشخصية مع تأثيرات الحركة
            ctx.save();
            ctx.translate(player.x + player.width/2, player.y + player.height/2);
            
            if (player.jumping) {
                // دوران خفيف أثناء القفز
                ctx.rotate(Math.sin(player.jumpHeight * 0.05) * 0.1);
            } else if (player.landing) {
                // حركة الهبوط - انحناء للأمام
                ctx.scale(1.1, 0.9);
            } else if (player.animating) {
                // حركة أثناء التنقل بين المسارات
                ctx.scale(1.05, 0.95);
            }
            
            // رسم الشخصية (الملابس مدمجة في الشخصية)
            if (player.currentClothes.includes('👮') || player.currentClothes.includes('👨‍') || player.currentClothes.includes('👩‍')) {
                // إذا كانت الملابس شخصية كاملة، ارسمها بدلاً من الشخصية الأساسية
                ctx.fillText(player.currentClothes, 0, 0);
            } else {
                // ارسم الشخصية الأساسية
                ctx.fillText(currentSprite, 0, 0);
            }
            
            ctx.restore();
            ctx.shadowBlur = 0;

            // رسم الشرطي مع حركة الجري
            ctx.font = '50px Arial';
            police.runningFrame = (police.runningFrame + 0.15) % 2;
            const policeSprite = Math.floor(police.runningFrame) === 0 ? '👮‍♂️' : '🏃‍♂️';
            ctx.fillText(policeSprite, player.x + player.width/2, player.y + 100);

            // رسم العقبات - قطارات وسيارات
            ctx.font = '50px Arial';
            obstacles.forEach(obstacle => {
                ctx.save();
                ctx.translate(obstacle.x + obstacle.width/2, obstacle.y + obstacle.height/2);
                
                // تأثير حركة خفيف للمركبات
                if (obstacle.type.includes('🚂') || obstacle.type.includes('🚆') || obstacle.type.includes('🚄')) {
                    // حركة اهتزاز للقطارات
                    ctx.translate(Math.sin(animationFrame * 0.3) * 1, 0);
                } else {
                    // حركة خفيفة للسيارات
                    ctx.translate(Math.sin(animationFrame * 0.2) * 0.5, 0);
                }
                
                ctx.fillText(obstacle.type, 0, 15);
                ctx.restore();
            });

            // رسم الأموال مع تأثير الدوران
            moneyCoins.forEach((coin, index) => {
                ctx.save();
                ctx.translate(coin.x + coin.width/2, coin.y + coin.height/2);
                ctx.rotate((animationFrame + index * 10) * 0.1);
                ctx.fillText('💰', 0, 10);
                ctx.restore();
            });

            // رسم الجسيمات
            particles.forEach(particle => {
                const alpha = particle.life / particle.maxLife;
                ctx.fillStyle = `rgba(255, 215, 0, ${alpha})`;
                ctx.fillRect(particle.x, particle.y, 3, 3);
            });

            // تحديث واجهة المستخدم
            document.getElementById('score').textContent = score;
            document.getElementById('coins').textContent = coins;
            document.getElementById('level').textContent = level;

            animationFrame++;
        }

        function gameLoop() {
            if (!gameRunning) return;

            updatePlayer();
            createObstacle();
            createMoney();
            updateObstacles();
            checkCollisions();
            draw();

            // زيادة السرعة تدريجياً - أبطأ للسهولة
            if (level <= 5) {
                gameSpeed += 0.001; // بطيء جداً في البداية
            } else if (level <= 10) {
                gameSpeed += 0.002; // بطيء
            } else {
                gameSpeed += 0.003; // عادي
            }

            requestAnimationFrame(gameLoop);
        }

        // تحديث حجم الكانفاس عند تغيير اتجاه الشاشة
        window.addEventListener('resize', () => {
            resizeCanvas();
            updatePlayerPosition();
            player.y = canvas.height - 150;
        });

        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                resizeCanvas();
                updatePlayerPosition();
                player.y = canvas.height - 150;
            }, 100);
        });

        // تهيئة الملابس
        updateClothesGrid();
    </script>
</body>
</html>
