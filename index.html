<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>-يوسف الصيفي لعبة الهروب من الشرطي</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            direction: rtl;
            position: fixed;
            width: 100%;
            height: 100%;
            touch-action: none;
        }

        #gameContainer {
            width: 100vw;
            height: 100vh;
            position: relative;
            background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 100%);
        }

        #gameCanvas {
            display: block;
            background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 100%);
            touch-action: none;
        }

        #gameUI {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 100;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 10px;
        }

        #levelUp {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 215, 0, 0.9);
            color: #000;
            font-size: 24px;
            font-weight: bold;
            padding: 20px;
            border-radius: 15px;
            display: none;
            z-index: 150;
            animation: bounce 0.5s ease-in-out;
        }

        @keyframes bounce {
            0%, 20%, 60%, 100% { transform: translate(-50%, -50%) translateY(0); }
            40% { transform: translate(-50%, -50%) translateY(-10px); }
            80% { transform: translate(-50%, -50%) translateY(-5px); }
        }

        #startScreen, #gameOverScreen, #clothesScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 200;
            overflow-y: auto;
            padding: 20px;
        }

        #gameOverScreen, #clothesScreen {
            display: none;
        }

        button {
            padding: 12px 25px;
            font-size: 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px;
            transition: all 0.3s;
            min-height: 44px;
            min-width: 100px;
        }

        button:hover, button:active {
            background: #45a049;
            transform: scale(0.95);
        }

        .character-btn {
            background: #2196F3;
            margin: 5px;
            padding: 12px 20px;
            font-size: 14px;
        }

        .character-btn:hover, .character-btn:active {
            background: #1976D2;
        }

        .character-btn.selected {
            background: #FF9800;
        }

        .clothes-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
            max-width: 300px;
        }

        .clothes-btn {
            background: #9C27B0;
            font-size: 20px;
            padding: 15px;
            border-radius: 10px;
            min-height: 60px;
        }

        .clothes-btn:hover, .clothes-btn:active {
            background: #7B1FA2;
        }

        .clothes-btn.selected {
            background: #FF5722;
            box-shadow: 0 0 15px rgba(255, 87, 34, 0.5);
        }

        #instructions {
            text-align: center;
            margin: 15px;
            font-size: 14px;
            line-height: 1.4;
        }

        .mobile-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            z-index: 100;
        }

        .control-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.5);
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
        }

        .control-btn:active {
            background: rgba(255, 255, 255, 0.5);
            transform: scale(0.9);
        }

        .character-animation {
            animation: characterMove 0.5s ease-in-out;
        }

        @keyframes characterMove {
            0% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-5px) rotate(-5deg); }
            50% { transform: translateY(-10px) rotate(0deg); }
            75% { transform: translateY(-5px) rotate(5deg); }
            100% { transform: translateY(0px) rotate(0deg); }
        }

        .special-effect {
            animation: sparkle 1s ease-in-out infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        @media (max-width: 480px) {
            #gameUI {
                font-size: 14px;
                top: 5px;
                right: 5px;
                padding: 8px;
            }
            
            button {
                font-size: 14px;
                padding: 10px 20px;
            }
            
            .control-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        
        <div id="gameUI">
            <div>النقاط: <span id="score">0</span></div>
            <div>الأموال: <span id="coins">0</span></div>
            <div>المستوى: <span id="level">1</span></div>
        </div>

        <div id="levelUp">
            🎉 مستوى جديد! 🎉
            <div style="font-size: 18px; margin-top: 10px;">تم فتح ملابس جديدة!</div>
        </div>

        <div class="mobile-controls">
            <div class="control-btn" id="leftBtn">←</div>
            <div class="control-btn" id="jumpBtn">↑</div>
            <div class="control-btn" id="rightBtn">→</div>
        </div>

        <div id="startScreen">
            <h1 style="font-size: 36px; margin-bottom: 20px; color: #FFD700;">🏃‍♂️ لعبة الهروب من الشرطي</h1>
            
            <div id="instructions">
                <p>🎮 استخدم الأزرار أو اللمس للحركة</p>
                <p>⬆️ اقفز فوق العقبات</p>
                <p>⬅️➡️ تحرك يميناً ويساراً</p>
                <p>💰 اجمع الأموال واتجنب العقبات</p>
                <p>👮 اهرب من الشرطي!</p>
                <p>🎯 كل 100 نقطة = مستوى جديد وملابس جديدة!</p>
            </div>

            <div style="margin: 15px;">
                <h3>اختر شخصيتك:</h3>
                <div style="display: flex; flex-wrap: wrap; justify-content: center;">
                    <button class="character-btn selected" data-character="boy">👦 الولد</button>
                    <button class="character-btn" data-character="girl">👧 الأخت</button>
                    <button class="character-btn" data-character="father">👨 الأب</button>
                    <button class="character-btn" data-character="mother">👩 الأم</button>
                </div>
            </div>

            <button onclick="showClothesScreen()">تغيير الملابس 👕</button>
            <button onclick="startGame()">ابدأ اللعب</button>
        </div>

        <div id="clothesScreen">
            <h2 style="font-size: 28px; margin-bottom: 20px;">👕 اختر ملابسك</h2>
            <div>المستوى الحالي: <span id="clothesLevel">1</span></div>
            <div style="margin-bottom: 20px;">الملابس المتاحة حسب مستواك</div>
            
            <div class="clothes-grid" id="clothesGrid">
                <!-- سيتم ملؤها بـ JavaScript -->
            </div>
            
            <button onclick="backToStart()">العودة للقائمة الرئيسية</button>
        </div>

        <div id="gameOverScreen">
            <h2 style="font-size: 28px; margin-bottom: 15px;">انتهت اللعبة! 😵</h2>
            <div style="font-size: 20px; margin-bottom: 15px;">
                <div>النقاط النهائية: <span id="finalScore">0</span></div>
                <div>الأموال المجمعة: <span id="finalCoins">0</span></div>
                <div>المستوى المحقق: <span id="finalLevel">1</span></div>
            </div>
            <button onclick="restartGame()">العب مرة أخرى</button>
            <button onclick="showStartScreen()">الشاشة الرئيسية</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // إعداد حجم الكانفاس للهاتف
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();

        // متغيرات اللعبة
        let gameRunning = false;
        let score = 0;
        let coins = 0;
        let level = 1;
        let gameSpeed = 3;
        let selectedCharacter = 'boy';
        let selectedClothes = '👕';
        let animationFrame = 0;
        let isMoving = false;
        let specialEffect = false;

        // شخصيات اللعبة
        const characters = {
            boy: '👦',
            girl: '👧', 
            father: '👨',
            mother: '👩'
        };

        // ملابس متاحة حسب المستوى
        const clothesByLevel = {
            1: ['👕', '👔', '🦺'],
            2: ['👗', '👘', '🥼'],
            3: ['🧥', '👚', '🥻'],
            4: ['🦸‍♂️', '🦸‍♀️', '🧙‍♂️'],
            5: ['👑', '🎩', '🧢'],
            6: ['🤴', '👸', '🧞‍♂️']
        };

        // اللاعب
        const player = {
            x: canvas.width / 2,
            y: canvas.height - 150,
            width: 50,
            height: 50,
            velocityY: 0,
            jumping: false,
            lane: 1,
            character: '👦',
            clothes: '👕',
            animating: false
        };

        // الشرطي
        const police = {
            x: canvas.width / 2,
            y: canvas.height - 200,
            width: 50,
            height: 50,
            character: '👮'
        };

        // العقبات والأموال
        let obstacles = [];
        let moneyCoins = [];
        let particles = [];

        // التحكم باللمس المحسن للهاتف
        let touchStartX = 0;
        let touchStartY = 0;
        let isSwipeGesture = false;
        const swipeThreshold = 30;
        const tapTimeout = 200;

        // إعداد أزرار التحكم للهاتف
        document.getElementById('leftBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            moveLeft();
        });

        document.getElementById('rightBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            moveRight();
        });

        document.getElementById('jumpBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            jump();
        });

        // منع السلوك الافتراضي للمس
        document.addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });

        // التحكم بالحركة السريعة
        function moveLeft() {
            if (player.lane > 0) {
                player.lane--;
                updatePlayerPosition();
                player.animating = true;
                setTimeout(() => { player.animating = false; }, 300);
            }
        }

        function moveRight() {
            if (player.lane < 2) {
                player.lane++;
                updatePlayerPosition();
                player.animating = true;
                setTimeout(() => { player.animating = false; }, 300);
            }
        }

        function jump() {
            if (!player.jumping) {
                player.velocityY = -18;
                player.jumping = true;
                player.animating = true;
                setTimeout(() => { player.animating = false; }, 500);
            }
        }

        function updatePlayerPosition() {
            const laneWidth = canvas.width / 3;
            player.x = laneWidth * player.lane + (laneWidth / 2) - (player.width / 2);
        }

        // التحكم بالسحب السريع
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
            isSwipeGesture = false;
        }, { passive: false });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (!gameRunning) return;
            
            const touchX = e.touches[0].clientX;
            const touchY = e.touches[0].clientY;
            const deltaX = touchX - touchStartX;
            const deltaY = touchY - touchStartY;

            if (Math.abs(deltaX) > swipeThreshold || Math.abs(deltaY) > swipeThreshold) {
                isSwipeGesture = true;
                
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    // حركة أفقية سريعة
                    if (deltaX > swipeThreshold) {
                        moveRight();
                        touchStartX = touchX; // إعادة تعيين للحركة المستمرة
                    } else if (deltaX < -swipeThreshold) {
                        moveLeft();
                        touchStartX = touchX;
                    }
                } else if (deltaY < -swipeThreshold) {
                    // حركة عمودية للقفز
                    jump();
                    touchStartY = touchY;
                }
            }
        }, { passive: false });

        canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
            if (!isSwipeGesture && gameRunning) {
                // نقرة سريعة للقفز
                jump();
            }
        }, { passive: false });

        // اختيار الشخصية
        document.querySelectorAll('.character-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.character-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                selectedCharacter = btn.dataset.character;
                updateClothesLevel();
            });
        });

        function showClothesScreen() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('clothesScreen').style.display = 'flex';
            updateClothesGrid();
        }

        function backToStart() {
            document.getElementById('clothesScreen').style.display = 'none';
            document.getElementById('startScreen').style.display = 'flex';
        }

        function updateClothesLevel() {
            document.getElementById('clothesLevel').textContent = level;
        }

        function updateClothesGrid() {
            const grid = document.getElementById('clothesGrid');
            grid.innerHTML = '';
            
            for (let lvl = 1; lvl <= level; lvl++) {
                if (clothesByLevel[lvl]) {
                    clothesByLevel[lvl].forEach(clothes => {
                        const btn = document.createElement('button');
                        btn.className = 'clothes-btn';
                        btn.textContent = clothes;
                        if (clothes === selectedClothes) {
                            btn.classList.add('selected');
                        }
                        btn.addEventListener('click', () => {
                            document.querySelectorAll('.clothes-btn').forEach(b => b.classList.remove('selected'));
                            btn.classList.add('selected');
                            selectedClothes = clothes;
                        });
                        grid.appendChild(btn);
                    });
                }
            }
        }

        function startGame() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('clothesScreen').style.display = 'none';
            gameRunning = true;
            score = 0;
            coins = 0;
            gameSpeed = 3;
            animationFrame = 0;
            
            // إعداد اللاعب
            player.character = characters[selectedCharacter];
            player.clothes = selectedClothes;
            updatePlayerPosition();
            player.y = canvas.height - 150;
            player.velocityY = 0;
            player.jumping = false;
            player.lane = 1;

            // إعادة تعيين المصفوفات
            obstacles = [];
            moneyCoins = [];
            particles = [];

            gameLoop();
        }

        function restartGame() {
            document.getElementById('gameOverScreen').style.display = 'none';
            startGame();
        }

        function showStartScreen() {
            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('startScreen').style.display = 'flex';
            gameRunning = false;
        }

        function gameOver() {
            gameRunning = false;
            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalCoins').textContent = coins;
            document.getElementById('finalLevel').textContent = level;
            document.getElementById('gameOverScreen').style.display = 'flex';
        }

        function checkLevelUp() {
            const newLevel = Math.floor(score / 100) + 1;
            if (newLevel > level) {
                level = newLevel;
                showLevelUp();
                specialEffect = true;
                setTimeout(() => { specialEffect = false; }, 3000);
            }
        }

        function showLevelUp() {
            const levelUpDiv = document.getElementById('levelUp');
            levelUpDiv.style.display = 'block';
            setTimeout(() => {
                levelUpDiv.style.display = 'none';
            }, 2000);
        }

        function updatePlayer() {
            // فيزياء القفز المحسنة
            if (player.jumping) {
                player.y += player.velocityY;
                player.velocityY += 0.9; // جاذبية قوية للهاتف

                if (player.y >= canvas.height - 150) {
                    player.y = canvas.height - 150;
                    player.jumping = false;
                    player.velocityY = 0;
                }
            }
        }

        function createObstacle() {
            if (Math.random() < 0.025 + (level * 0.005)) {
                const lane = Math.floor(Math.random() * 3);
                const laneWidth = canvas.width / 3;
                obstacles.push({
                    x: laneWidth * lane + (laneWidth / 2) - 25,
                    y: -60,
                    width: 50,
                    height: 50,
                    type: Math.random() < 0.5 ? '🚧' : '🚗'
                });
            }
        }

        function createMoney() {
            if (Math.random() < 0.02) {
                const lane = Math.floor(Math.random() * 3);
                const laneWidth = canvas.width / 3;
                moneyCoins.push({
                    x: laneWidth * lane + (laneWidth / 2) - 20,
                    y: -40,
                    width: 40,
                    height: 40
                });
            }
        }

        function createParticle(x, y) {
            for (let i = 0; i < 5; i++) {
                particles.push({
                    x: x,
                    y: y,
                    velocityX: (Math.random() - 0.5) * 4,
                    velocityY: -Math.random() * 3,
                    life: 30,
                    maxLife: 30
                });
            }
        }

        function updateObstacles() {
            // تحديث العقبات
            for (let i = obstacles.length - 1; i >= 0; i--) {
                obstacles[i].y += gameSpeed;
                
                if (obstacles[i].y > canvas.height) {
                    obstacles.splice(i, 1);
                    score += 15;
                    checkLevelUp();
                }
            }

            // تحديث الأموال
            for (let i = moneyCoins.length - 1; i >= 0; i--) {
                moneyCoins[i].y += gameSpeed;
                
                if (moneyCoins[i].y > canvas.height) {
                    moneyCoins.splice(i, 1);
                }
            }

            // تحديث الجسيمات
            for (let i = particles.length - 1; i >= 0; i--) {
                const particle = particles[i];
                particle.x += particle.velocityX;
                particle.y += particle.velocityY;
                particle.velocityY += 0.1;
                particle.life--;
                
                if (particle.life <= 0) {
                    particles.splice(i, 1);
                }
            }
        }

        function checkCollisions() {
            // التصادم مع العقبات
            obstacles.forEach(obstacle => {
                if (player.x < obstacle.x + obstacle.width &&
                    player.x + player.width > obstacle.x &&
                    player.y < obstacle.y + obstacle.height &&
                    player.y + player.height > obstacle.y) {
                    gameOver();
                }
            });

            // جمع الأموال
            for (let i = moneyCoins.length - 1; i >= 0; i--) {
                const coin = moneyCoins[i];
                if (player.x < coin.x + coin.width &&
                    player.x + player.width > coin.x &&
                    player.y < coin.y + coin.height &&
                    player.y + player.height > coin.y) {
                    moneyCoins.splice(i, 1);
                    coins += 15;
                    score += 10;
                    createParticle(coin.x, coin.y);
                    checkLevelUp();
                }
            }
        }

        function draw() {
            // مسح الشاشة
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#98FB98');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // رسم الخطوط
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 4;
            ctx.setLineDash([30, 15]);
            
            const laneWidth = canvas.width / 3;
            for (let i = 1; i < 3; i++) {
                ctx.beginPath();
                ctx.moveTo(laneWidth * i, 0);
                ctx.lineTo(laneWidth * i, canvas.height);
                ctx.stroke();
            }

            // رسم اللاعب مع التأثيرات
            ctx.font = '50px Arial';
            ctx.textAlign = 'center';
            
            if (specialEffect) {
                ctx.shadowColor = '#FFD700';
                ctx.shadowBlur = 20;
            }
            
            // رسم الملابس أولاً
            ctx.fillText(player.clothes, player.x + player.width/2, player.y + 35);
            // ثم الشخصية
            ctx.fillText(player.character, player.x + player.width/2, player.y + 40);
            
            ctx.shadowBlur = 0;

            // رسم الشرطي
            ctx.fillText(police.character, player.x + player.width/2, player.y + 90);

            // رسم العقبات
            obstacles.forEach(obstacle => {
                ctx.fillText(obstacle.type, obstacle.x + obstacle.width/2, obstacle.y + 40);
            });

            // رسم الأموال مع تأثير الدوران
            moneyCoins.forEach((coin, index) => {
                ctx.save();
                ctx.translate(coin.x + coin.width/2, coin.y + coin.height/2);
                ctx.rotate((animationFrame + index * 10) * 0.1);
                ctx.fillText('💰', 0, 10);
                ctx.restore();
            });

            // رسم الجسيمات
            particles.forEach(particle => {
                const alpha = particle.life / particle.maxLife;
                ctx.fillStyle = `rgba(255, 215, 0, ${alpha})`;
                ctx.fillRect(particle.x, particle.y, 3, 3);
            });

            // تحديث واجهة المستخدم
            document.getElementById('score').textContent = score;
            document.getElementById('coins').textContent = coins;
            document.getElementById('level').textContent = level;

            animationFrame++;
        }

        function gameLoop() {
            if (!gameRunning) return;

            updatePlayer();
            createObstacle();
            createMoney();
            updateObstacles();
            checkCollisions();
            draw();

            // زيادة السرعة تدريجياً
            gameSpeed += 0.003;

            requestAnimationFrame(gameLoop);
        }

        // تحديث حجم الكانفاس عند تغيير اتجاه الشاشة
        window.addEventListener('resize', () => {
            resizeCanvas();
            updatePlayerPosition();
            player.y = canvas.height - 150;
        });

        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                resizeCanvas();
                updatePlayerPosition();
                player.y = canvas.height - 150;
            }, 100);
        });

        // تهيئة الملابس
        updateClothesGrid();
    </script>
</body>
</html>
